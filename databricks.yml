bundle:
  name: lakebase-agent-demo

sync:
  include:
    - .build

artifacts:
  default:
    build: uv run apx build

resources:
  apps:
    lakebase-agent-demo-app:
      name: "lakebase-agent-demo"
      description: "Data & Bricks Store - E-commerce demo powered by Lakebase"
      source_code_path: ./.build
      config:
        env:
          # Production Lakebase connection (production branch)
          - name: LAKEBASE_AGENT_DEMO_DB_HOST
            value: "ep-young-mode-d1ljatae.database.us-west-2.cloud.databricks.com"
          - name: LAKEBASE_AGENT_DEMO_DB_PORT
            value: "5432"
          - name: LAKEBASE_AGENT_DEMO_DB_NAME
            value: "databricks_postgres"
          - name: LAKEBASE_AGENT_DEMO_DB_SSLMODE
            value: "require"
          - name: LAKEBASE_AGENT_DEMO_DB_OAUTH_ENDPOINT
            value: "projects/9e2e7ee4-bc9e-4753-8249-f8f49f8ac26d/branches/br-ancient-star-d17umpql/endpoints/ep-young-mode-d1ljatae"
          # OAuth mode (recommended for deployed app): set via Databricks App secrets:
          #   DATABRICKS_CLIENT_ID, DATABRICKS_CLIENT_SECRET, DATABRICKS_HOST,
          #   LAKEBASE_AGENT_DEMO_DB_OAUTH_ENDPOINT (full path, e.g. projects/{project_id}/branches/{branch_id}/endpoints/{endpoint_id})
          # The app derives DB user (client_id) and password (OAuth token) at startup and runs Alembic migrations.
          # Do not set LAKEBASE_AGENT_DEMO_DB_USER / LAKEBASE_AGENT_DEMO_DB_PASSWORD when using OAuth.

targets:
  dev:
    mode: development
    default: true