bundle:
  name: lakebase-agent-demo

sync:
  include:
    - .build

artifacts:
  default:
    build: uv run apx build

resources:
  apps:
    lakebase-agent-demo-app:
      name: "lakebase-agent-demo"
      description: "Data & Bricks Store - E-commerce demo powered by Lakebase"
      source_code_path: ./.build
      config:
        env:
          # Production Lakebase connection -- fill these in before deploying
          - name: LAKEBASE_AGENT_DEMO_DB_HOST
            value: "<YOUR_PRODUCTION_ENDPOINT_HOST>"
          - name: LAKEBASE_AGENT_DEMO_DB_PORT
            value: "5432"
          - name: LAKEBASE_AGENT_DEMO_DB_NAME
            value: "databricks_postgres"
          - name: LAKEBASE_AGENT_DEMO_DB_SSLMODE
            value: "require"
          - name: LAKEBASE_AGENT_DEMO_DB_OAUTH_ENDPOINT
            value: "<YOUR_PRODUCTION_ENDPOINT_PATH>"
          # LAKEBASE_AGENT_DEMO_DB_OAUTH_ENDPOINT format: projects/{project_id}/branches/{branch_id}/endpoints/{endpoint_id}
          # OAuth mode (recommended for deployed app): set via Databricks App secrets:
          #   DATABRICKS_CLIENT_ID, DATABRICKS_CLIENT_SECRET, DATABRICKS_HOST
          # The app derives DB user (client_id) and password (OAuth token) at startup and runs Alembic migrations.
          # Do not set LAKEBASE_AGENT_DEMO_DB_USER / LAKEBASE_AGENT_DEMO_DB_PASSWORD when using OAuth.

targets:
  dev:
    mode: development
    default: true